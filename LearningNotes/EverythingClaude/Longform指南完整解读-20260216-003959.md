# The Longform Guide å®Œæ•´è§£è¯»

> Everything Claude Code é•¿ç¯‡æŒ‡å—çš„æ·±åº¦è§£æå’Œå®è·µå»ºè®®

**ç”Ÿæˆæ—¶é—´**: 2026-02-16 00:39:59
**åŸæ–‡æ¥æº**: `github.com/affaan-m/everything-claude-code/the-longform-guide.md`
**å‰ç½®è¦æ±‚**: éœ€è¦å…ˆé˜…è¯» The Shorthand Guide å¹¶å®ŒæˆåŸºç¡€é…ç½®

---

## ç›®å½•

- [æŒ‡å—å®šä½](#æŒ‡å—å®šä½)
- [æ ¸å¿ƒä¸»é¢˜](#æ ¸å¿ƒä¸»é¢˜)
  - [1. MCP ä¼˜åŒ–ç­–ç•¥](#1-mcp-ä¼˜åŒ–ç­–ç•¥)
  - [2. ä¸Šä¸‹æ–‡å’Œå†…å­˜ç®¡ç†](#2-ä¸Šä¸‹æ–‡å’Œå†…å­˜ç®¡ç†)
  - [3. æŒç»­å­¦ä¹ ä¸è‡ªåŠ¨åŒ–](#3-æŒç»­å­¦ä¹ ä¸è‡ªåŠ¨åŒ–)
  - [4. Token ä¼˜åŒ–](#4-token-ä¼˜åŒ–)
  - [5. éªŒè¯å¾ªç¯å’Œè¯„ä¼°](#5-éªŒè¯å¾ªç¯å’Œè¯„ä¼°)
  - [6. å¹¶è¡ŒåŒ–ç­–ç•¥](#6-å¹¶è¡ŒåŒ–ç­–ç•¥)
  - [7. é¡¹ç›®å¯åŠ¨æ¨¡å¼](#7-é¡¹ç›®å¯åŠ¨æ¨¡å¼)
  - [8. ä»£ç†æœ€ä½³å®è·µ](#8-ä»£ç†æœ€ä½³å®è·µ)
- [å®ç”¨æŠ€å·§](#å®ç”¨æŠ€å·§)
- [èµ„æºå’Œå‚è€ƒ](#èµ„æºå’Œå‚è€ƒ)

---

## æŒ‡å—å®šä½

### ä¸ Shorthand Guide çš„å…³ç³»

- **Shorthand Guide**: åŸºç¡€è®¾æ–½å’Œé…ç½®ï¼ˆskills, hooks, subagents, MCPs, pluginsï¼‰
- **Longform Guide**: ç”Ÿäº§åŠ›æŠ€å·§å’Œæ¨¡å¼ï¼Œå°†"èƒ½ç”¨"æå‡åˆ°"é«˜æ•ˆ"

### æ ¸å¿ƒç›®æ ‡

> è¿™äº›æ˜¯ç»è¿‡ 10+ ä¸ªæœˆæ—¥å¸¸ä½¿ç”¨æç‚¼å‡ºçš„æ¨¡å¼ï¼Œè®©ä½ ä»"ç¬¬ä¸€ä¸ªå°æ—¶å°±é­é‡ä¸Šä¸‹æ–‡è…çƒ‚"å˜æˆ"ä¿æŒæ•°å°æ—¶çš„ç”Ÿäº§åŠ›ä¼šè¯"ã€‚

### äº”å¤§ä¸»é¢˜

1. **Token ç»æµå­¦** - å¦‚ä½•æœ€å°åŒ–æˆæœ¬
2. **å†…å­˜æŒä¹…åŒ–** - è·¨ä¼šè¯çš„è®°å¿†ç®¡ç†
3. **éªŒè¯æ¨¡å¼** - ç¡®ä¿ä»£ç è´¨é‡
4. **å¹¶è¡ŒåŒ–ç­–ç•¥** - å¤šå®ä¾‹åä½œ
5. **å¯å¤ç”¨å·¥ä½œæµçš„å¤åˆ©æ•ˆåº”** - æŠ•èµ„å›æŠ¥æœ€å¤§åŒ–

---

## æ ¸å¿ƒä¸»é¢˜

### 1. MCP ä¼˜åŒ–ç­–ç•¥

#### é—®é¢˜è¯†åˆ«

å¾ˆå¤š MCPï¼ˆå¦‚ GitHub, Supabase, Vercel, Railwayï¼‰æœ¬è´¨ä¸Šåªæ˜¯ CLI çš„åŒ…è£…å™¨ï¼š

```
MCP = CLI åŒ…è£…å™¨ + ä¸Šä¸‹æ–‡çª—å£å ç”¨ + Token æ¶ˆè€—
```

#### ä¼˜åŒ–æ–¹æ¡ˆ

**æ›¿ä»£æ–¹æ¡ˆ**: CLI + Skills + Commands

```bash
# ä¼ ç»Ÿæ–¹å¼ï¼šåŠ è½½ GitHub MCP
# æˆæœ¬ï¼šæŒç»­å ç”¨ä¸Šä¸‹æ–‡çª—å£

# ä¼˜åŒ–æ–¹å¼ï¼šåˆ›å»ºå‘½ä»¤
/gh-pr â†’ åŒ…è£… gh pr create --title "..." --body "..."
/gh-review â†’ åŒ…è£… gh pr review ...
```

#### å…·ä½“å®ç°ç¤ºä¾‹

**åˆ›å»º `/gh-pr` å‘½ä»¤**:
```json
{
  "commands": {
    "gh-pr": {
      "description": "Create GitHub PR with standard template",
      "command": "gh pr create --title \"$1\" --body \"$(cat .github/pr-template.md)\" --assignee @me"
    }
  }
}
```

**åˆ›å»º Supabase Skill**:
```markdown
---
name: supabase-deploy
description: Deploy to Supabase using CLI
---

# Supabase Deployment

Always use the Supabase CLI instead of the MCP:

\`\`\`bash
# Link project
supabase link --project-ref $PROJECT_REF

# Push migrations
supabase db push

# Deploy functions
supabase functions deploy
\`\`\`
```

#### æ•ˆæœå¯¹æ¯”

| æ–¹æ³• | ä¸Šä¸‹æ–‡å ç”¨ | Token ä½¿ç”¨ | çµæ´»æ€§ |
|------|-----------|-----------|--------|
| MCP å…¨åŠ è½½ | é«˜ï¼ˆå§‹ç»ˆåŠ è½½ï¼‰ | é«˜ | ä¸­ |
| Lazy Loading MCP | ä¸­ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰ | ä¸­ | ä¸­ |
| CLI + Skills | ä½ï¼ˆä»…åœ¨ä½¿ç”¨æ—¶ï¼‰ | ä½ | é«˜ |

**ç»“è®º**: å³ä½¿æœ‰ lazy loadingï¼ŒCLI + skills æ–¹æ³•åœ¨ token ä¼˜åŒ–å’Œæˆæœ¬æ§åˆ¶ä¸Šä»ç„¶æ›´ä¼˜ã€‚

---

### 2. ä¸Šä¸‹æ–‡å’Œå†…å­˜ç®¡ç†

è¿™æ˜¯ Longform Guide çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚

#### 2.1 ä¼šè¯å­˜å‚¨ç³»ç»Ÿ

**æ ¸å¿ƒç†å¿µ**: åœ¨ `~/.claude/` æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ `.tmp` æ–‡ä»¶å­˜å‚¨ä¼šè¯çŠ¶æ€

**æ–‡ä»¶ç»“æ„**:
```
~/.claude/
â””â”€â”€ sessions/
    â”œâ”€â”€ 2026-02-14-feature-auth.tmp
    â”œâ”€â”€ 2026-02-15-bugfix-api.tmp
    â””â”€â”€ 2026-02-16-refactor-db.tmp
```

**ä¼šè¯æ–‡ä»¶æ¨¡æ¿**:
```markdown
# Session: Auth Feature Implementation
**Date:** 2026-02-15
**Started:** 09:30
**Last Updated:** 17:45

---

## What Worked (with Evidence)
- âœ… JWT RS256 signing with key rotation
  - Evidence: Tests pass, no token validation errors in logs
- âœ… Redis for refresh token storage (7-day TTL)
  - Evidence: `redis-cli TTL refresh:user:123` shows correct expiry

## What Didn't Work
- âŒ HS256 signature (tried first)
  - Problem: Can't distribute keys securely across services
  - Time wasted: 2 hours
- âŒ Storing refresh tokens in PostgreSQL
  - Problem: Too slow for high-frequency validation
  - Time wasted: 1 hour

## What's Left to Do
- [ ] Add rate limiting to auth endpoints
- [ ] Implement token blacklist for logout
- [ ] Add CSRF protection for cookie-based storage

## Code Locations
- `src/middleware/auth.js` - JWT verification
- `src/routes/auth.js` - Login/logout/refresh endpoints
- `src/services/token.service.js` - Token generation

## Key Decisions
- Using RS256 over HS256 for microservices architecture
- 15-minute access token expiry (balance security/UX)
- Refresh token rotation on every use (security best practice)
```

#### 2.2 æˆ˜ç•¥æ€§ä¸Šä¸‹æ–‡æ¸…ç†

**é—®é¢˜**: æ¢ç´¢é˜¶æ®µç§¯ç´¯å¤§é‡ä¸Šä¸‹æ–‡ï¼Œä½†æ‰§è¡Œæ—¶ä¸å†éœ€è¦

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. å®Œæˆæ¢ç´¢å’Œè®¡åˆ’
# 2. ä½¿ç”¨ Plan Mode æ¸…ç†ä¸Šä¸‹æ–‡ï¼ˆç°åœ¨æ˜¯é»˜è®¤é€‰é¡¹ï¼‰
# 3. ä»è®¡åˆ’æ–‡æ¡£å¼€å§‹æ‰§è¡Œ

# æˆ–è€…ï¼šæ‰‹åŠ¨å‹ç¼©
# - ç¦ç”¨ auto compact
# - åœ¨é€»è¾‘é—´éš”æ‰‹åŠ¨ /compact
# - æˆ–åˆ›å»º skill è‡ªåŠ¨åŒ–
```

**Strategic Compact Skill ç¤ºä¾‹**:
```markdown
---
name: strategic-compact
description: Suggest compaction at logical intervals
---

Monitor tool usage count. When it reaches ~50 edits/writes, suggest:

"Consider running /compact now. You've made 50+ changes.
Compacting will preserve key decisions while clearing exploration context."
```

#### 2.3 åŠ¨æ€ç³»ç»Ÿæç¤ºæ³¨å…¥

**ä¼ ç»Ÿæ–¹æ³•é—®é¢˜**:
- `CLAUDE.md` (ç”¨æˆ·çº§) å’Œ `.claude/rules/` (é¡¹ç›®çº§) æ¯æ¬¡éƒ½åŠ è½½
- æ— æ³•æ ¹æ®ä»»åŠ¡ç±»å‹åŠ¨æ€è°ƒæ•´ä¸Šä¸‹æ–‡

**é«˜çº§æ–¹æ³•**: ä½¿ç”¨ CLI å‚æ•°åŠ¨æ€æ³¨å…¥

```bash
# åŸºç¡€è¯­æ³•
claude --system-prompt "$(cat memory.md)"
```

**å®æˆ˜è®¾ç½®**:

```bash
# ~/.bashrc æˆ– ~/.zshrc

# å¼€å‘æ¨¡å¼
alias claude-dev='claude --system-prompt "$(cat ~/.claude/contexts/dev.md)"'

# PR å®¡æŸ¥æ¨¡å¼
alias claude-review='claude --system-prompt "$(cat ~/.claude/contexts/review.md)"'

# ç ”ç©¶/æ¢ç´¢æ¨¡å¼
alias claude-research='claude --system-prompt "$(cat ~/.claude/contexts/research.md)"'

# è°ƒè¯•æ¨¡å¼
alias claude-debug='claude --system-prompt "$(cat ~/.claude/contexts/debug.md)"'

# é‡æ„æ¨¡å¼
alias claude-refactor='claude --system-prompt "$(cat ~/.claude/contexts/refactor.md)"'
```

**ä¸Šä¸‹æ–‡æ–‡ä»¶ç¤ºä¾‹**:

**`~/.claude/contexts/dev.md`**:
```markdown
# Development Mode

You are in active development mode. Priorities:
1. Write tests first (TDD)
2. Keep files under 400 lines
3. Document key decisions in code comments
4. No console.log in production code

Project context loaded from: ./CLAUDE.md
Previous session: $(cat ~/.claude/sessions/latest.tmp)
```

**`~/.claude/contexts/review.md`**:
```markdown
# PR Review Mode

Focus on:
- Security vulnerabilities (OWASP Top 10)
- Performance issues (N+1 queries, memory leaks)
- Test coverage gaps
- Breaking changes to public APIs
- Documentation completeness

Be thorough but constructive. Suggest improvements, not just criticisms.
```

**æç¤ºæƒé™å±‚çº§**:
```
System Prompt > User Messages > Tool Results
     â†‘              â†‘                â†‘
  æœ€é«˜æƒé™      ä¸­ç­‰æƒé™         æœ€ä½æƒé™
```

#### 2.4 å†…å­˜æŒä¹…åŒ–é’©å­

**ä¸‰ä¸ªå…³é”®é’©å­**:

1. **PreCompact Hook** - å‹ç¼©å‰ä¿å­˜çŠ¶æ€
2. **Stop Hook (Session End)** - ä¼šè¯ç»“æŸæ—¶æŒä¹…åŒ–å­¦ä¹ 
3. **SessionStart Hook** - æ–°ä¼šè¯æ—¶è‡ªåŠ¨åŠ è½½ä¸Šä¸‹æ–‡

**å®ç°ä½ç½®**: `github.com/affaan-m/everything-claude-code/tree/main/hooks/memory-persistence`

**é…ç½®ç¤ºä¾‹**:
```json
{
  "hooks": {
    "PreCompact": [{
      "matcher": "*",
      "hooks": [{
        "type": "command",
        "command": "~/.claude/scripts/hooks/pre-compact.js"
      }],
      "description": "Save state before context compaction"
    }],
    "SessionEnd": [{
      "matcher": "*",
      "hooks": [{
        "type": "command",
        "command": "~/.claude/scripts/hooks/session-end.js"
      }],
      "description": "Persist learnings to session file"
    }],
    "SessionStart": [{
      "matcher": "*",
      "hooks": [{
        "type": "command",
        "command": "~/.claude/scripts/hooks/session-start.js"
      }],
      "description": "Load previous context automatically"
    }]
  }
}
```

**å·¥ä½œæµç¨‹**:

```mermaid
graph LR
    A[ä¼šè¯å¼€å§‹] --> B[SessionStart Hook]
    B --> C[åŠ è½½ä¸Šæ¬¡ä¼šè¯]
    C --> D[å·¥ä½œä¸­...]
    D --> E[ä¸Šä¸‹æ–‡å‹ç¼©?]
    E -->|æ˜¯| F[PreCompact Hook]
    F --> G[ä¿å­˜é‡è¦çŠ¶æ€]
    G --> D
    E -->|å¦| D
    D --> H[ä¼šè¯ç»“æŸ]
    H --> I[Stop/SessionEnd Hook]
    I --> J[ä¿å­˜å­¦ä¹ å†…å®¹]
```

---

### 3. æŒç»­å­¦ä¹ ä¸è‡ªåŠ¨åŒ–

#### é—®é¢˜é™ˆè¿°

**ç—‡çŠ¶**: ä½ å¤šæ¬¡é‡å¤ç›¸åŒçš„æç¤ºï¼ŒClaude ç»™å‡ºç›¸åŒçš„é”™è¯¯æˆ–å“åº”

**æˆæœ¬**:
- æµªè´¹ Token
- æµªè´¹ä¸Šä¸‹æ–‡
- æµªè´¹æ—¶é—´

#### è§£å†³æ–¹æ¡ˆæ¶æ„

**æŒç»­å­¦ä¹ ç³»ç»Ÿ**: è‡ªåŠ¨å°†éå¹³å‡¡çš„çŸ¥è¯†ä¿å­˜ä¸º Skills

```
å‘ç°æ¨¡å¼ â†’ è¯„ä¼°ä»·å€¼ â†’ ä¿å­˜ä¸º Skill â†’ ä¸‹æ¬¡è‡ªåŠ¨åŠ è½½
```

**å®ç°**: `github.com/affaan-m/everything-claude-code/tree/main/skills/continuous-learning`

#### å…³é”®è®¾è®¡å†³ç­–ï¼šStop Hook vs UserPromptSubmit

| é’©å­ç±»å‹ | è§¦å‘æ—¶æœº | æ€§èƒ½å½±å“ | é€‚ç”¨åœºæ™¯ |
|---------|---------|---------|---------|
| **UserPromptSubmit** | æ¯æ¡æ¶ˆæ¯ | âŒ å¢åŠ å»¶è¿Ÿ | å®æ—¶æ‹¦æˆª |
| **Stop Hook** | ä¼šè¯ç»“æŸ | âœ… æ— å»¶è¿Ÿ | æ‰¹é‡åˆ†æ |

**ä¸ºä»€ä¹ˆé€‰æ‹© Stop Hook**:
- è½»é‡çº§ï¼šä¼šè¯ç»“æŸè¿è¡Œä¸€æ¬¡
- éé˜»å¡ï¼šä¸å½±å“äº¤äº’ä½“éªŒ
- å®Œæ•´ä¸Šä¸‹æ–‡ï¼šå¯ä»¥è®¿é—®æ•´ä¸ªä¼šè¯è®°å½•

#### æŒç»­å­¦ä¹ å·¥ä½œæµ

```javascript
// evaluate-session.js (Stop Hook)

// 1. æ£€æŸ¥ä¼šè¯é•¿åº¦
const messageCount = countMessagesInTranscript();
if (messageCount < 10) {
  return; // çŸ­ä¼šè¯ä¸è¯„ä¼°
}

// 2. åˆ†ææ¨¡å¼
const patterns = extractPatterns(transcript);
// patterns = [
//   { type: 'error_resolution', pattern: 'JWT v9 breaking change', confidence: 0.9 },
//   { type: 'workaround', pattern: 'Redis TTL format', confidence: 0.8 }
// ]

// 3. ä¿å­˜ä¸º Skill
for (const pattern of patterns) {
  if (pattern.confidence > 0.7) {
    saveAsSkill(pattern);
  }
}
```

**é…ç½®æ–‡ä»¶** (`config.json`):
```json
{
  "min_session_length": 10,
  "extraction_threshold": "medium",
  "learned_skills_path": "~/.claude/skills/learned/",
  "patterns_to_detect": [
    "error_resolution",        // é”™è¯¯è§£å†³æ–¹æ¡ˆ
    "user_corrections",        // ç”¨æˆ·çº æ­£
    "workarounds",            // å˜é€šæ–¹æ¡ˆ
    "debugging_techniques",    // è°ƒè¯•æŠ€æœ¯
    "project_specific"        // é¡¹ç›®ç‰¹å®šæ¨¡å¼
  ],
  "ignore_patterns": [
    "simple_typos",           // ç®€å•æ‹¼å†™é”™è¯¯
    "one_time_fixes",         // ä¸€æ¬¡æ€§ä¿®å¤
    "external_api_issues"     // å¤–éƒ¨ API é—®é¢˜
  ]
}
```

#### å®é™…ä¾‹å­

**ç¬¬ä¸€æ¬¡é‡åˆ°é—®é¢˜**:
```
User: "ä¸ºä»€ä¹ˆ JWT token ç«‹å³è¿‡æœŸï¼Ÿ"
Claude: "æ£€æŸ¥ expiresIn å‚æ•°ï¼Œåº”è¯¥ä½¿ç”¨ç§’æ•°ä¸æ˜¯æ¯«ç§’..."
[æ‰‹åŠ¨è§£å†³ï¼Œè€—æ—¶ 30 åˆ†é’Ÿ]
```

**ç¬¬äºŒæ¬¡é‡åˆ°**:
```
User: "åˆæ˜¯ token è¿‡æœŸé—®é¢˜..."
Claude: "æ£€æŸ¥ expiresIn å‚æ•°..."
[å†æ¬¡æ‰‹åŠ¨è§£å†³ï¼Œè€—æ—¶ 20 åˆ†é’Ÿ]
```

**ç¬¬ä¸‰æ¬¡** (è¾¾åˆ°é˜ˆå€¼ï¼Œè‡ªåŠ¨å­¦ä¹ ):
```
[SessionEnd Hook æ£€æµ‹åˆ°æ¨¡å¼é‡å¤]
[ContinuousLearning] Detected pattern: jwt-expiry-common-mistake
[ContinuousLearning] Saved to ~/.claude/skills/learned/jwt-expiry-fix.md
```

**ç¬¬å››æ¬¡** (è‡ªåŠ¨åº”ç”¨çŸ¥è¯†):
```
User: "JWT token è¿‡æœŸé—®é¢˜"
[SessionStart åŠ è½½ learned skills]
Claude: "æ ¹æ®ä¹‹å‰çš„ç»éªŒï¼Œè¿™é€šå¸¸æ˜¯ expiresIn å‚æ•°æ ¼å¼é—®é¢˜ã€‚
       jsonwebtoken v9+ éœ€è¦å­—ç¬¦ä¸²æ ¼å¼ï¼šexpiresIn: '15m'
       è€Œä¸æ˜¯æ¯«ç§’æ•°ï¼šexpiresIn: 900000

       æ£€æŸ¥ä½ çš„ä»£ç ä¸­æ˜¯å¦ä½¿ç”¨äº† Date.now() + milliseconds çš„å½¢å¼ã€‚"
[ç›´æ¥è§£å†³ï¼Œè€—æ—¶ 2 åˆ†é’Ÿ]
```

**ROI è®¡ç®—**:
- ç¬¬ä¸€æ¬¡ï¼š30 åˆ†é’Ÿ
- ç¬¬äºŒæ¬¡ï¼š20 åˆ†é’Ÿ
- ç¬¬ä¸‰æ¬¡ï¼š25 åˆ†é’Ÿï¼ˆæ„å»º skillï¼‰
- ç¬¬å››æ¬¡ï¼š2 åˆ†é’Ÿ âœ…
- **æ€»è®¡**: ä»ç¬¬å››æ¬¡å¼€å§‹ï¼Œæ¯æ¬¡èŠ‚çœ 28 åˆ†é’Ÿ

---

### 4. Token ä¼˜åŒ–

#### 4.1 å­ä»£ç†æ¶æ„

**æ ¸å¿ƒç­–ç•¥**: ä½¿ç”¨æœ€ä¾¿å®œä¸”è¶³å¤Ÿçš„æ¨¡å‹

**æ¨¡å‹é€‰æ‹©çŸ©é˜µ**:

| ä»»åŠ¡ç±»å‹ | æ¨èæ¨¡å‹ | ç†ç”± | æˆæœ¬ |
|---------|---------|------|------|
| **æ¢ç´¢/æœç´¢** | Haiku | å¿«é€Ÿã€ä¾¿å®œï¼Œæ‰¾æ–‡ä»¶å¤Ÿç”¨ | $ |
| **ç®€å•ç¼–è¾‘** | Haiku | å•æ–‡ä»¶ä¿®æ”¹ï¼ŒæŒ‡ä»¤æ¸…æ™° | $ |
| **æ–‡æ¡£ç¼–å†™** | Haiku | ç»“æ„ç®€å• | $ |
| **å¤šæ–‡ä»¶å®ç°** | Sonnet | ç¼–ç æœ€ä½³å¹³è¡¡ | $$ |
| **PR å®¡æŸ¥** | Sonnet | ç†è§£ä¸Šä¸‹æ–‡ï¼Œæ•è·ç»†å¾®é—®é¢˜ | $$ |
| **å¤æ‚æ¶æ„** | Opus | éœ€è¦æ·±åº¦æ¨ç† | $$$ |
| **å®‰å…¨åˆ†æ** | Opus | ä¸èƒ½é”™è¿‡æ¼æ´ | $$$ |
| **è°ƒè¯•å¤æ‚ Bug** | Opus | éœ€è¦åœ¨è„‘ä¸­ä¿æŒæ•´ä¸ªç³»ç»Ÿ | $$$ |

**å®šä»·å‚è€ƒ** (2026-02-16):

| æ¨¡å‹ | Input ($/M tokens) | Output ($/M tokens) |
|------|-------------------|---------------------|
| **Claude 3.5 Haiku** | $1 | $5 |
| **Claude 3.5 Sonnet** | $3 | $15 |
| **Claude 3.5 Opus** | $15 | $75 |

**å®è·µå»ºè®®**:
- é»˜è®¤ä½¿ç”¨ **Sonnet** å¤„ç† 90% çš„ç¼–ç ä»»åŠ¡
- å‡çº§åˆ° **Opus** çš„åœºæ™¯ï¼š
  - é¦–æ¬¡å°è¯•å¤±è´¥
  - ä»»åŠ¡è·¨è¶Š 5+ æ–‡ä»¶
  - æ¶æ„å†³ç­–
  - å®‰å…¨å…³é”®ä»£ç 

#### 4.2 å·¥å…·ç‰¹å®šä¼˜åŒ–

**mgrep vs ripgrep**:

```bash
# ä¼ ç»Ÿæ–¹å¼
rg "pattern" --json | process...
# Token ä½¿ç”¨ï¼š~1000 tokensï¼ˆå¤§é‡ JSON å…ƒæ•°æ®ï¼‰

# ä¼˜åŒ–æ–¹å¼
mgrep "pattern"
# Token ä½¿ç”¨ï¼š~500 tokensï¼ˆæ™ºèƒ½æ‘˜è¦ï¼‰
# Token å‡å°‘ï¼š~50%
```

**åŸºå‡†æµ‹è¯•ç»“æœ**:
> åœ¨ 50 ä¸ªä»»åŠ¡çš„åŸºå‡†æµ‹è¯•ä¸­ï¼Œmgrep + Claude Code ä½¿ç”¨çš„ token çº¦ä¸º grep-based å·¥ä½œæµçš„ **ä¸€åŠ**ï¼Œè´¨é‡ç›¸åŒæˆ–æ›´å¥½ã€‚

**æ¥æº**: https://github.com/mixedbread-ai/mgrep

**å®‰è£… mgrep**:
```bash
# macOS
brew install mgrep

# Linux
cargo install mgrep

# é…ç½® Claude Code ä½¿ç”¨ mgrep
echo 'export CLAUDE_GREP_TOOL=mgrep' >> ~/.bashrc
```

#### 4.3 ä»£ç åº“æ¨¡å—åŒ–

**åŸåˆ™**: ä¸»æ–‡ä»¶ä¿æŒåœ¨æ•°ç™¾è¡Œï¼Œè€Œä¸æ˜¯æ•°åƒè¡Œ

**ä¸ºä»€ä¹ˆ**:
1. **Token ä¼˜åŒ–**: è¯»å–å’Œä¸Šä¸‹æ–‡æ›´å°
2. **é¦–æ¬¡æˆåŠŸç‡æ›´é«˜**: Claude æ›´å®¹æ˜“ç†è§£æ•´ä¸ªæ–‡ä»¶
3. **æ›´å¥½çš„å¯ç»´æŠ¤æ€§**: äººç±»å’Œ AI éƒ½å—ç›Š

**æ–‡ä»¶å¤§å°æŒ‡å—**:

| æ–‡ä»¶å¤§å° | çŠ¶æ€ | æ“ä½œ |
|---------|------|------|
| < 200 è¡Œ | âœ… ç†æƒ³ | æ—  |
| 200-400 è¡Œ | âœ… è‰¯å¥½ | æ—  |
| 400-800 è¡Œ | âš ï¸ å¯æ¥å— | è€ƒè™‘æ‹†åˆ† |
| > 800 è¡Œ | âŒ è¿‡å¤§ | å¿…é¡»é‡æ„ |

**é‡æ„ç­–ç•¥**:

```javascript
// âŒ ä¹‹å‰ï¼šä¸€ä¸ª 1500 è¡Œçš„ UserController.js

// âœ… ä¹‹åï¼šæ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡å—
src/controllers/user/
â”œâ”€â”€ index.js           (50 è¡Œ - å…¥å£)
â”œâ”€â”€ auth.js            (200 è¡Œ - è®¤è¯é€»è¾‘)
â”œâ”€â”€ profile.js         (150 è¡Œ - ç”¨æˆ·èµ„æ–™)
â”œâ”€â”€ settings.js        (180 è¡Œ - è®¾ç½®ç®¡ç†)
â””â”€â”€ validation.js      (120 è¡Œ - è¾“å…¥éªŒè¯)
```

**Hook ç¤ºä¾‹** (é˜»æ­¢å¤§æ–‡ä»¶åˆ›å»º):
```json
{
  "matcher": "Write",
  "hooks": [{
    "type": "command",
    "command": "node -e \"let d='';process.stdin.on('data',c=>d+=c);process.stdin.on('end',()=>{const i=JSON.parse(d);const c=i.tool_input?.content||'';const lines=c.split('\\n').length;if(lines>800){console.error('[Hook] BLOCKED: File exceeds 800 lines ('+lines+')');console.error('[Hook] Split into smaller modules');process.exit(2)}console.log(d)})\""
  }],
  "description": "Block creation of files > 800 lines"
}
```

---

### 5. éªŒè¯å¾ªç¯å’Œè¯„ä¼°

#### 5.1 åŸºå‡†æµ‹è¯•å·¥ä½œæµ

**Fork å¯¹æ¯”æ³•**:

```bash
# 1. Fork å½“å‰å¯¹è¯
/fork

# 2. åœ¨ä¸€ä¸ªåˆ†æ”¯ä½¿ç”¨ skill
[Branch A] ä½¿ç”¨ /tdd skill

# 3. åœ¨å¦ä¸€ä¸ªåˆ†æ”¯ä¸ä½¿ç”¨ skill
[Branch B] æ‰‹åŠ¨æ“ä½œ

# 4. å¯¹æ¯”ç»“æœ
git worktree add ../test-a feature-a
git worktree add ../test-b feature-b

# åœ¨ä¸¤ä¸ªç›®å½•ä¸­è¿è¡Œ Claude
cd ../test-a && claude  # ä½¿ç”¨ skill
cd ../test-b && claude  # ä¸ä½¿ç”¨ skill

# 5. æ¯”è¾ƒå·®å¼‚
diff -r ../test-a ../test-b
```

**è¯„ä¼°ç»´åº¦**:
- âœ… åŠŸèƒ½å®Œæ•´æ€§
- âœ… ä»£ç è´¨é‡
- âœ… Token ä½¿ç”¨é‡
- âœ… å®Œæˆæ—¶é—´
- âœ… Bug æ•°é‡

#### 5.2 è¯„ä¼°æ¨¡å¼ç±»å‹

**1. Checkpoint-Based Evalsï¼ˆæ£€æŸ¥ç‚¹è¯„ä¼°ï¼‰**:

```markdown
# æ£€æŸ¥ç‚¹ 1: åŸºç¡€ç»“æ„
- [ ] é¡¹ç›®åˆå§‹åŒ–å®Œæˆ
- [ ] ä¾èµ–å®‰è£…æˆåŠŸ
- [ ] æµ‹è¯•æ¡†æ¶é…ç½®
â†’ éªŒè¯é€šè¿‡æ‰ç»§ç»­

# æ£€æŸ¥ç‚¹ 2: æ ¸å¿ƒåŠŸèƒ½
- [ ] API ç«¯ç‚¹å®ç°
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
â†’ éªŒè¯é€šè¿‡æ‰ç»§ç»­

# æ£€æŸ¥ç‚¹ 3: è¾¹ç•Œæƒ…å†µ
- [ ] é”™è¯¯å¤„ç†å®Œæ•´
- [ ] è¾¹ç•Œå€¼æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
â†’ éªŒè¯é€šè¿‡æ‰ç»§ç»­
```

**2. Continuous Evalsï¼ˆæŒç»­è¯„ä¼°ï¼‰**:

```bash
# æ¯ N åˆ†é’Ÿæˆ–æ¯æ¬¡é‡å¤§æ›´æ”¹åè¿è¡Œ
watch -n 300 "npm test && npm run lint"

# æˆ–ä½¿ç”¨ Hook
{
  "matcher": "Edit",
  "hooks": [{
    "type": "command",
    "command": "npm test",
    "async": true,
    "condition": "files_changed >= 3"
  }]
}
```

#### 5.3 å…³é”®æŒ‡æ ‡

**pass@k** (è‡³å°‘ä¸€æ¬¡æˆåŠŸ):
```
k=1: 70%  (å•æ¬¡å°è¯•æˆåŠŸç‡)
k=3: 91%  (ä¸‰æ¬¡ä¸­è‡³å°‘ä¸€æ¬¡æˆåŠŸ)
k=5: 97%  (äº”æ¬¡ä¸­è‡³å°‘ä¸€æ¬¡æˆåŠŸ)
```

**pass^k** (å…¨éƒ¨æˆåŠŸ):
```
k=1: 70%  (å•æ¬¡å°è¯•æˆåŠŸç‡)
k=3: 34%  (ä¸‰æ¬¡å…¨éƒ¨æˆåŠŸç‡)
k=5: 17%  (äº”æ¬¡å…¨éƒ¨æˆåŠŸç‡)
```

**ä½¿ç”¨åœºæ™¯**:
- **pass@k**: "æˆ‘åªéœ€è¦å®ƒèƒ½å·¥ä½œ" â†’ é€‚åˆåŸå‹ã€POC
- **pass^k**: "æˆ‘éœ€è¦ä¸€è‡´æ€§" â†’ é€‚åˆç”Ÿäº§ä»£ç ã€å…³é”®åŠŸèƒ½

**å®é™…åº”ç”¨**:

```bash
# ä½¿ç”¨ pass@3 ç­–ç•¥ï¼ˆè¿è¡Œ 3 æ¬¡ï¼Œè‡³å°‘ 1 æ¬¡æˆåŠŸï¼‰
for i in {1..3}; do
  echo "Attempt $i..."
  if npm test; then
    echo "âœ… Tests passed on attempt $i"
    break
  fi
done

# ä½¿ç”¨ pass^3 ç­–ç•¥ï¼ˆè¿è¡Œ 3 æ¬¡ï¼Œå…¨éƒ¨å¿…é¡»æˆåŠŸï¼‰
success_count=0
for i in {1..3}; do
  echo "Attempt $i..."
  if npm test; then
    ((success_count++))
  fi
done

if [ $success_count -eq 3 ]; then
  echo "âœ… All 3 attempts passed"
else
  echo "âŒ Only $success_count/3 passed"
fi
```

---

### 6. å¹¶è¡ŒåŒ–ç­–ç•¥

#### 6.1 æ ¸å¿ƒåŸåˆ™

**é¦–è¦ç›®æ ‡**:
> ç”¨æœ€å°‘çš„å¹¶è¡ŒåŒ–å®Œæˆæœ€å¤šçš„å·¥ä½œ

**åæ¨¡å¼**:
```bash
# âŒ é”™è¯¯ï¼šç›²ç›®å¼€å¯å¤šä¸ªç»ˆç«¯
# 5 ä¸ªæœ¬åœ° + 5 ä¸ªäº‘ç«¯ = 10 ä¸ªå®ä¾‹
# é—®é¢˜ï¼šåè°ƒæˆæœ¬ > å¹¶è¡Œæ”¶ç›Š
```

**æ­£ç¡®æ–¹å¼**:
```bash
# âœ… æ­£ç¡®ï¼šæ ¹æ®çœŸå®éœ€æ±‚æ·»åŠ å®ä¾‹
# ä¸»ç»ˆç«¯ï¼šä»£ç ä¿®æ”¹
# ç»ˆç«¯ 2ï¼šä»…åœ¨éœ€è¦æ—¶ç”¨äºç ”ç©¶/æ–‡æ¡£æŸ¥è¯¢
```

#### 6.2 åˆ†å·¥æ¨¡å¼

**æ¨èæ¨¡å¼**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»ç»ˆç«¯         â”‚  è¾…åŠ©ç»ˆç«¯        â”‚
â”‚  (ä»£ç ä¿®æ”¹)     â”‚  (é—®ç­”/ç ”ç©¶)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Edit          â”‚ - Read          â”‚
â”‚ - Write         â”‚ - Grep          â”‚
â”‚ - Bash (build)  â”‚ - WebSearch     â”‚
â”‚ - Test          â”‚ - Documentation â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®è§„åˆ™**:
- âœ… ä¸»ç»ˆç«¯è´Ÿè´£æ‰€æœ‰ä»£ç æ›´æ”¹
- âœ… è¾…åŠ©ç»ˆç«¯ä»…ç”¨äºåªè¯»æŸ¥è¯¢
- âŒ é¿å…å¤šä¸ªç»ˆç«¯ä¿®æ”¹é‡å çš„æ–‡ä»¶

#### 6.3 Git Worktrees å®ç°çœŸå¹¶è¡Œ

**åœºæ™¯**: éœ€è¦å¤šä¸ªç»ˆç«¯åŒæ—¶ä¿®æ”¹ä»£ç 

**è§£å†³æ–¹æ¡ˆ**: Git Worktrees

```bash
# åˆ›å»º worktrees
git worktree add ../project-feature-a feature-a
git worktree add ../project-feature-b feature-b
git worktree add ../project-refactor refactor-branch

# ç›®å½•ç»“æ„
~/projects/
â”œâ”€â”€ myapp/                  (main branch)
â”œâ”€â”€ myapp-feature-a/        (feature-a branch)
â”œâ”€â”€ myapp-feature-b/        (feature-b branch)
â””â”€â”€ myapp-refactor/         (refactor-branch)

# åœ¨æ¯ä¸ªç›®å½•ä¸­å¯åŠ¨ Claude
cd ~/projects/myapp-feature-a && claude
cd ~/projects/myapp-feature-b && claude
cd ~/projects/myapp-refactor && claude
```

**ä½¿ç”¨ `/rename` æ ‡è¯†ä¼šè¯**:
```
Terminal 1: /rename feature-auth
Terminal 2: /rename feature-payment
Terminal 3: /rename refactor-db
```

**å·¥ä½œæµç¨‹**:
```mermaid
graph TB
    A[Main Branch] --> B[Worktree: feature-a]
    A --> C[Worktree: feature-b]
    A --> D[Worktree: refactor]
    B --> E[Claude Instance 1]
    C --> F[Claude Instance 2]
    D --> G[Claude Instance 3]
    E --> H[å®Œæˆå merge]
    F --> H
    G --> H
```

#### 6.4 Cascade Methodï¼ˆç€‘å¸ƒæ³•ï¼‰

**ç»„ç»‡å¤šä¸ªå®ä¾‹**:

```
Tab 1: Main Code (oldest)
  â†“
Tab 2: Research
  â†“
Tab 3: Testing
  â†“
Tab 4: New Feature (newest)

æ‰«ææ–¹å‘: â† ä»å·¦åˆ°å³ï¼Œä»æ—§åˆ°æ–°
```

**è§„åˆ™**:
1. æ–°ä»»åŠ¡åœ¨å³ä¾§æ–°å»ºæ ‡ç­¾
2. ä»å·¦åˆ°å³æ‰«æï¼Œå¤„ç†æ—§ä»»åŠ¡
3. åŒæ—¶å…³æ³¨æœ€å¤š 3-4 ä¸ªä»»åŠ¡
4. å®Œæˆçš„ä»»åŠ¡å…³é—­ï¼Œé‡Šæ”¾æ³¨æ„åŠ›

#### 6.5 Fork çš„æ­£ç¡®ä½¿ç”¨

**åœºæ™¯ 1: æ¢ç´¢æ€§é—®é¢˜**
```
ä¸»å¯¹è¯: æ­£åœ¨å®ç°åŠŸèƒ½
  â†“ /fork
åˆ†æ”¯: "è¿™ä¸ªåº“çš„ API æ˜¯æ€ä¹ˆè®¾è®¡çš„ï¼Ÿ"
  â†“ å›ç­”åå…³é—­åˆ†æ”¯
ä¸»å¯¹è¯: ç»§ç»­å®ç°
```

**åœºæ™¯ 2: å¹¶è¡Œç ”ç©¶**
```
ä¸»å¯¹è¯: å®ç°æ”¯ä»˜é›†æˆ
  â†“ /fork
åˆ†æ”¯ A: "ç ”ç©¶ Stripe API æœ€ä½³å®è·µ"
  â†“ /fork
åˆ†æ”¯ B: "æŸ¥çœ‹æˆ‘ä»¬çš„é”™è¯¯å¤„ç†æ¨¡å¼"
  â†“ åˆå¹¶å‘ç°
ä¸»å¯¹è¯: åº”ç”¨ç ”ç©¶ç»“æœå®ç°
```

---

### 7. é¡¹ç›®å¯åŠ¨æ¨¡å¼

#### 7.1 åŒå®ä¾‹å¯åŠ¨æ¨¡å¼

**åœºæ™¯**: å¯åŠ¨ä¸€ä¸ªæ–°é¡¹ç›®

**è®¾ç½®**: 2 ä¸ª Claude å®ä¾‹

**Instance 1: Scaffolding Agentï¼ˆè„šæ‰‹æ¶ä»£ç†ï¼‰**

èŒè´£:
- ğŸ—ï¸ åˆ›å»ºé¡¹ç›®ç»“æ„
- ğŸ“ è®¾ç½®é…ç½®æ–‡ä»¶
- ğŸ› ï¸ åˆå§‹åŒ–å·¥å…·é“¾

```bash
# Terminal 1
cd ~/projects/new-project
claude

# æŒ‡ä»¤
"è®¾ç½®ä¸€ä¸ª Next.js + TypeScript + Tailwind é¡¹ç›®ï¼ŒåŒ…æ‹¬ï¼š
- é¡¹ç›®ç»“æ„ï¼ˆæŒ‰åŠŸèƒ½ç»„ç»‡ï¼‰
- CLAUDE.md é…ç½®
- .claude/rules/ è§„åˆ™
- .claude/agents/ ä»£ç†é…ç½®
- ESLint + Prettier
- æµ‹è¯•æ¡†æ¶ï¼ˆVitestï¼‰
"
```

**Instance 2: Deep Research Agentï¼ˆæ·±åº¦ç ”ç©¶ä»£ç†ï¼‰**

èŒè´£:
- ğŸ” è¿æ¥åˆ°æœåŠ¡å’Œ API
- ğŸ“š åˆ›å»ºè¯¦ç»†çš„ PRD
- ğŸ“Š ç»˜åˆ¶æ¶æ„å›¾ï¼ˆMermaidï¼‰
- ğŸ“– æ”¶é›†æ–‡æ¡£ç‰‡æ®µ

```bash
# Terminal 2
cd ~/projects/new-project
claude

# æŒ‡ä»¤
"åˆ›å»ºé¡¹ç›®æ–‡æ¡£ï¼š
1. è¿æ¥åˆ° Supabaseã€Stripeã€SendGrid
2. ç¼–å†™è¯¦ç»†çš„ PRDï¼ˆäº§å“éœ€æ±‚æ–‡æ¡£ï¼‰
3. ç»˜åˆ¶ç³»ç»Ÿæ¶æ„ Mermaid å›¾
   - æ•°æ®æµå›¾
   - ç»„ä»¶å…³ç³»å›¾
   - API ç«¯ç‚¹åœ°å›¾
4. æ•´ç†å…³é”®æ–‡æ¡£ç‰‡æ®µ
   - Next.js App Router æœ€ä½³å®è·µ
   - Supabase è®¤è¯æ¨¡å¼
   - Stripe è®¢é˜…é›†æˆæŒ‡å—
"
```

**åè°ƒæµç¨‹**:

```mermaid
graph LR
    A[é¡¹ç›®å¼€å§‹] --> B[Instance 1: è„šæ‰‹æ¶]
    A --> C[Instance 2: ç ”ç©¶]
    B --> D[åŸºç¡€ç»“æ„å®Œæˆ]
    C --> E[PRD + æ–‡æ¡£å®Œæˆ]
    D --> F[åˆå¹¶ç‚¹]
    E --> F
    F --> G[å¼€å§‹å¼€å‘]
```

**æ—¶é—´ä¼°ç®—**:
- Instance 1: 15-20 åˆ†é’Ÿï¼ˆè„šæ‰‹æ¶ï¼‰
- Instance 2: 20-30 åˆ†é’Ÿï¼ˆç ”ç©¶å’Œæ–‡æ¡£ï¼‰
- **å¹¶è¡Œæ€»æ—¶é—´**: ~25 åˆ†é’Ÿï¼ˆvs é¡ºåº ~45 åˆ†é’Ÿï¼‰

#### 7.2 llms.txt æ¨¡å¼

**å‘ç° llms.txt**:

```bash
# è®¸å¤šæ–‡æ¡£ç½‘ç«™æä¾› LLM ä¼˜åŒ–ç‰ˆæœ¬
https://docs.example.com/llms.txt

# å¸¸è§ä½ç½®
https://nextjs.org/llms.txt
https://supabase.com/llms.txt
https://stripe.com/llms.txt
```

**ä½¿ç”¨æ–¹æ³•**:

```bash
# 1. è·å– llms.txt
curl https://docs.framework.com/llms.txt > framework-docs.txt

# 2. åœ¨ Claude Code ä¸­ä½¿ç”¨
"å‚è€ƒ framework-docs.txtï¼Œå®ç°ç”¨æˆ·è®¤è¯æµç¨‹"

# æˆ–è€…ï¼šæ·»åŠ åˆ°ç³»ç»Ÿæç¤º
claude --system-prompt "$(cat framework-docs.txt)" \
      --system-prompt "$(cat memory.md)"
```

**ä¼˜åŠ¿**:
- âœ… ä¸“ä¸º LLM ä¼˜åŒ–çš„æ ¼å¼
- âœ… å»é™¤äº†æ— å…³çš„ UI/è¥é”€å†…å®¹
- âœ… ç»“æ„æ¸…æ™°ï¼Œæ˜“äºè§£æ
- âœ… Token ä½¿ç”¨æ›´å°‘

#### 7.3 å¤åˆ©æ•ˆåº”å“²å­¦

**å¼•ç”¨** (@omarsar0):
> "æ—©æœŸï¼Œæˆ‘èŠ±æ—¶é—´æ„å»ºå¯å¤ç”¨çš„å·¥ä½œæµ/æ¨¡å¼ã€‚æ„å»ºè¿‡ç¨‹å¾ˆç¹çï¼Œä½†éšç€æ¨¡å‹å’Œä»£ç†å·¥å…·çš„æ”¹è¿›ï¼Œäº§ç”Ÿäº†å·¨å¤§çš„å¤åˆ©æ•ˆåº”ã€‚"

**æŠ•èµ„ä¼˜å…ˆçº§**:

1. **Subagentsï¼ˆå­ä»£ç†ï¼‰** - ROI: â­â­â­â­â­
   - å¯å¤ç”¨æ€§é«˜
   - æ¨¡å‹æ”¹è¿›æ—¶è‡ªåŠ¨å—ç›Š
   - ç¤ºä¾‹ï¼štdd-agent, code-reviewer, build-fixer

2. **Skillsï¼ˆæŠ€èƒ½ï¼‰** - ROI: â­â­â­â­â­
   - ç¼–ç æ¨¡å¼å’Œæœ€ä½³å®è·µ
   - é¡¹ç›®ç‰¹å®šçŸ¥è¯†
   - ç¤ºä¾‹ï¼šdjango-patterns, react-best-practices

3. **Commandsï¼ˆå‘½ä»¤ï¼‰** - ROI: â­â­â­â­
   - é«˜é¢‘æ“ä½œçš„å¿«æ·æ–¹å¼
   - å‡å°‘é‡å¤è¾“å…¥
   - ç¤ºä¾‹ï¼š/gh-pr, /db-migrate, /deploy

4. **Planning Patternsï¼ˆè§„åˆ’æ¨¡å¼ï¼‰** - ROI: â­â­â­â­
   - ç»“æ„åŒ–é—®é¢˜è§£å†³
   - å¯é‡å¤çš„å·¥ä½œæµ
   - ç¤ºä¾‹ï¼š5-phase implementation, research-plan-implement

5. **MCP Toolsï¼ˆMCP å·¥å…·ï¼‰** - ROI: â­â­â­
   - å¤–éƒ¨æœåŠ¡é›†æˆ
   - ä¸Šä¸‹æ–‡å ç”¨æˆæœ¬
   - æƒè¡¡ï¼šåŠŸèƒ½ vs æˆæœ¬

6. **Context Engineering Patternsï¼ˆä¸Šä¸‹æ–‡å·¥ç¨‹æ¨¡å¼ï¼‰** - ROI: â­â­â­â­â­
   - æœ€å¤§åŒ– token æ•ˆç‡
   - æé«˜å“åº”è´¨é‡
   - ç¤ºä¾‹ï¼šdynamic prompts, strategic compaction

**æ—¶é—´æŠ•èµ„å»ºè®®**:

```
ç¬¬ 1 å‘¨: åŸºç¡€è®¾æ–½è®¾ç½®
- é…ç½® hooks
- åˆ›å»º 5-10 ä¸ªå¸¸ç”¨ skills
- è®¾ç½® 2-3 ä¸ª subagents

ç¬¬ 2-4 å‘¨: è¿­ä»£æ”¹è¿›
- æ ¹æ®å®é™…ä½¿ç”¨ä¼˜åŒ– skills
- æ·»åŠ é¡¹ç›®ç‰¹å®šæ¨¡å¼
- å»ºç«‹ continuous learning

ç¬¬ 2-6 æœˆ: å¤åˆ©é˜¶æ®µ
- Skills è‡ªåŠ¨ç§¯ç´¯
- Patterns é€æ¸æˆç†Ÿ
- ç”Ÿäº§åŠ›æ˜¾è‘—æå‡
```

---

### 8. ä»£ç†æœ€ä½³å®è·µ

#### 8.1 å­ä»£ç†ä¸Šä¸‹æ–‡é—®é¢˜

**æ ¸å¿ƒé—®é¢˜**:

```
Orchestrator: "åˆ†æ auth æ¨¡å—çš„æ€§èƒ½é—®é¢˜"
  â†“ ä¼ é€’ç»™å­ä»£ç†
Sub-agent: "åˆ†æ auth æ¨¡å—"  â† ç¼ºå°‘ PURPOSEï¼ˆç›®çš„ï¼‰
  â†“ è¿”å›
Sub-agent: "auth æ¨¡å—æœ‰ 5 ä¸ªæ–‡ä»¶ï¼Œå…± 1200 è¡Œ..."  â† ç¼ºå°‘é’ˆå¯¹æ€§

é—®é¢˜ï¼šå­ä»£ç†åªçŸ¥é“å­—é¢æŸ¥è¯¢ï¼Œä¸çŸ¥é“èƒŒåçš„ç›®çš„
```

**è§£å†³æ–¹æ¡ˆ**: ä¼ é€’ç›®æ ‡ä¸Šä¸‹æ–‡

```
Orchestrator: "åˆ†æ auth æ¨¡å—çš„æ€§èƒ½é—®é¢˜"
  â†“ å¢å¼ºçš„æç¤º
Sub-agent:
  æŸ¥è¯¢: "auth æ¨¡å—"
  ç›®æ ‡: "è¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Œç‰¹åˆ«æ˜¯ï¼š
         - æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡
         - ç¼“å­˜ä½¿ç”¨
         - Token éªŒè¯å¼€é”€"
  èƒŒæ™¯: "ç”¨æˆ·æŠ¥å‘Šç™»å½•å»¶è¿Ÿ 2-3 ç§’"
  â†“ è¿”å›
Sub-agent:
  "å‘ç° 3 ä¸ªæ€§èƒ½é—®é¢˜ï¼š
   1. auth.js:45 - N+1 æŸ¥è¯¢ï¼ˆç”¨æˆ·æƒé™ï¼‰
   2. token.service.js:120 - ç¼ºå°‘ Redis ç¼“å­˜
   3. middleware/auth.js:30 - æ¯æ¬¡è¯·æ±‚éƒ½éªŒè¯ç­¾å"
```

#### 8.2 è¿­ä»£æ£€ç´¢æ¨¡å¼

**æµç¨‹**:

```
1. Orchestrator å‘é€æŸ¥è¯¢ï¼ˆå¸¦ç›®æ ‡ä¸Šä¸‹æ–‡ï¼‰
   â†“
2. Sub-agent è¿”å›åˆæ­¥ç»“æœ
   â†“
3. Orchestrator è¯„ä¼°ç»“æœ
   â†“
4. ä¸è¶³ï¼Ÿæå‡ºè·Ÿè¿›é—®é¢˜
   â†“
5. Sub-agent å›åˆ°æºå¤´ï¼Œè·å–æ›´å¤šç»†èŠ‚
   â†“
6. å¾ªç¯ç›´åˆ°æ»¡è¶³ï¼ˆæœ€å¤š 3 è½®ï¼‰
```

**å®ç°ç¤ºä¾‹**:

```javascript
// orchestrator.js

async function analyzeWithIterativeRetrieval(query, objective, maxRounds = 3) {
  let round = 0;
  let result = null;
  let followUpQuestions = [];

  while (round < maxRounds) {
    round++;

    // è°ƒç”¨å­ä»£ç†
    result = await subAgent.analyze({
      query,
      objective,
      followUp: followUpQuestions,
      round
    });

    // è¯„ä¼°ç»“æœ
    const evaluation = evaluateCompleteness(result, objective);

    if (evaluation.complete) {
      console.log(`âœ… Satisfied after ${round} round(s)`);
      return result;
    }

    // ç”Ÿæˆè·Ÿè¿›é—®é¢˜
    followUpQuestions = generateFollowUpQuestions(result, evaluation.missing);
    console.log(`ğŸ”„ Round ${round}: ${followUpQuestions.length} follow-up questions`);
  }

  console.log(`âš ï¸ Max rounds (${maxRounds}) reached`);
  return result;
}
```

**å…·ä½“ä¾‹å­**:

```
Round 1:
  Query: "åˆ†æ auth æ¨¡å—"
  Return: "auth æ¨¡å—åŒ…å« login, logout, refresh åŠŸèƒ½"
  Evaluation: ç¼ºå°‘æ€§èƒ½æ•°æ®

Round 2:
  Follow-up: "login å‡½æ•°çš„å¹³å‡æ‰§è¡Œæ—¶é—´å’Œæ•°æ®åº“æŸ¥è¯¢æ•°é‡ï¼Ÿ"
  Return: "login å¹³å‡ 2.3sï¼Œæ‰§è¡Œ 15 ä¸ªæ•°æ®åº“æŸ¥è¯¢"
  Evaluation: ç¼ºå°‘å…·ä½“æŸ¥è¯¢ä½ç½®

Round 3:
  Follow-up: "15 ä¸ªæŸ¥è¯¢çš„å…·ä½“ä½ç½®å’Œ SQL è¯­å¥ï¼Ÿ"
  Return: "auth.js:45-67 - N+1 é—®é¢˜ï¼Œå¾ªç¯æŸ¥è¯¢ç”¨æˆ·è§’è‰²"
  Evaluation: âœ… å®Œæ•´
```

#### 8.3 ç¼–æ’å™¨é¡ºåºé˜¶æ®µæ¨¡å¼

**æ¶æ„**:

```markdown
Phase 1: RESEARCH
  Agent: Explore
  Input: é¡¹ç›®éœ€æ±‚æ–‡æ¡£
  Output: research-summary.md
  Exit Criteria: âœ… æŠ€æœ¯æ ˆç¡®å®šï¼Œâœ… å…³é”®é£é™©è¯†åˆ«

Phase 2: PLAN
  Agent: Planner
  Input: research-summary.md
  Output: plan.md
  Exit Criteria: âœ… ä»»åŠ¡åˆ†è§£å®Œæˆï¼Œâœ… ä¾èµ–å…³ç³»æ˜ç¡®

Phase 3: IMPLEMENT
  Agent: TDD-Guide
  Input: plan.md
  Output: ä»£ç  + æµ‹è¯•
  Exit Criteria: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œâœ… ä»£ç è¦†ç›–ç‡ > 80%

Phase 4: REVIEW
  Agent: Code-Reviewer
  Input: ä»£ç å˜æ›´ diff
  Output: review-comments.md
  Exit Criteria: âœ… æ— å…³é”®é—®é¢˜ï¼Œâœ… æœ€ä½³å®è·µéµå¾ª

Phase 5: VERIFY
  Agent: Build-Error-Resolver (if needed)
  Input: æ„å»º/æµ‹è¯•é”™è¯¯
  Output: ä¿®å¤ + éªŒè¯
  Exit Criteria: âœ… æ„å»ºæˆåŠŸï¼Œâœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

  Success â†’ DONE
  Failure â†’ å›åˆ° Phase 3
```

**å…³é”®è§„åˆ™**:

1. **æ¯ä¸ªä»£ç†ä¸€ä¸ªæ˜ç¡®çš„è¾“å…¥å’Œè¾“å‡º**
   ```
   âœ… Input: research-summary.md â†’ Output: plan.md
   âŒ Input: "ä¸€äº›ä¸Šä¸‹æ–‡" â†’ Output: "ä¸€äº›ä»£ç "
   ```

2. **è¾“å‡ºæˆä¸ºä¸‹ä¸€é˜¶æ®µçš„è¾“å…¥**
   ```
   research-summary.md â†’ plan.md â†’ code + tests â†’ review-comments.md
   ```

3. **æ°¸è¿œä¸è¦è·³è¿‡é˜¶æ®µ**
   ```
   âŒ Research â†’ Implement (è·³è¿‡ Plan)
   âœ… Research â†’ Plan â†’ Implement
   ```

4. **åœ¨ä»£ç†ä¹‹é—´ä½¿ç”¨ `/clear`**
   ```bash
   # Phase 1 å®Œæˆ
   /clear

   # Phase 2 å¼€å§‹ï¼ˆæ¸…ç†çš„ä¸Šä¸‹æ–‡ï¼‰
   "æ ¹æ® research-summary.mdï¼Œåˆ›å»ºå®æ–½è®¡åˆ’..."
   ```

5. **å°†ä¸­é—´è¾“å‡ºå­˜å‚¨åœ¨æ–‡ä»¶ä¸­**
   ```bash
   ~/.claude/sessions/current/
   â”œâ”€â”€ research-summary.md
   â”œâ”€â”€ plan.md
   â”œâ”€â”€ implementation-log.md
   â”œâ”€â”€ review-comments.md
   â””â”€â”€ verification-results.md
   ```

**ç¼–æ’å™¨å®ç°** (ä¼ªä»£ç ):

```javascript
// orchestrator.js

const phases = [
  {
    name: 'RESEARCH',
    agent: 'explore',
    input: 'requirements.md',
    output: 'research-summary.md',
    exitCriteria: ['tech_stack_decided', 'risks_identified']
  },
  {
    name: 'PLAN',
    agent: 'planner',
    input: 'research-summary.md',
    output: 'plan.md',
    exitCriteria: ['tasks_decomposed', 'dependencies_clear']
  },
  {
    name: 'IMPLEMENT',
    agent: 'tdd-guide',
    input: 'plan.md',
    output: 'code_changes',
    exitCriteria: ['tests_pass', 'coverage_above_80']
  },
  {
    name: 'REVIEW',
    agent: 'code-reviewer',
    input: 'git diff HEAD',
    output: 'review-comments.md',
    exitCriteria: ['no_critical_issues', 'best_practices_followed']
  },
  {
    name: 'VERIFY',
    agent: 'build-error-resolver',
    input: 'build_output',
    output: 'fixes',
    exitCriteria: ['build_success', 'tests_pass'],
    onFailure: 'goto IMPLEMENT'
  }
];

async function runOrchestrator() {
  for (const phase of phases) {
    console.log(`\n=== Phase: ${phase.name} ===`);

    // æ¸…ç†ä¸Šä¸‹æ–‡
    await claude.clear();

    // è¿è¡Œä»£ç†
    const result = await claude.runAgent(phase.agent, {
      input: readFile(phase.input),
      goal: phase.exitCriteria
    });

    // ä¿å­˜è¾“å‡º
    writeFile(phase.output, result);

    // æ£€æŸ¥é€€å‡ºæ ‡å‡†
    const criteriaMet = await checkExitCriteria(result, phase.exitCriteria);

    if (!criteriaMet && phase.onFailure) {
      console.log(`âš ï¸ Criteria not met, ${phase.onFailure}`);
      // å¤„ç†å¤±è´¥é€»è¾‘
    }
  }

  console.log('\nâœ… All phases complete');
}
```

---

## å®ç”¨æŠ€å·§

### è‡ªå®šä¹‰çŠ¶æ€æ 

**è®¾ç½®**:
```bash
/statusline
```

Claude ä¼šæç¤ºä½ é…ç½®æƒ³è¦æ˜¾ç¤ºçš„ä¿¡æ¯ï¼š
- å½“å‰ Git åˆ†æ”¯
- æœªæäº¤çš„æ›´æ”¹æ•°
- æœ€åä¸€æ¬¡æµ‹è¯•ç»“æœ
- Token ä½¿ç”¨é‡
- å½“å‰æ—¶é—´

**ç¬¬ä¸‰æ–¹å®ç°**: https://github.com/sirmalloc/ccstatusline

### è¯­éŸ³è½¬å½•

**å·¥å…·æ¨è**:
- **macOS**: superwhisper, MacWhisper
- **Windows**: (å¾…è¡¥å……)
- **Linux**: (å¾…è¡¥å……)

**ä¼˜åŠ¿**:
- æ¯”æ‰“å­—å¿«ï¼ˆå¯¹è®¸å¤šäººæ¥è¯´ï¼‰
- å³ä½¿æœ‰è½¬å½•é”™è¯¯ï¼ŒClaude ä¹Ÿèƒ½ç†è§£æ„å›¾
- é€‚åˆé•¿æ—¶é—´å·¥ä½œä¼šè¯

**ä½¿ç”¨æ–¹å¼**:
```
[å¯åŠ¨è¯­éŸ³è½¬å½•]
"æ‰“å¼€ auth.js æ–‡ä»¶ï¼Œæ‰¾åˆ° login å‡½æ•°ï¼Œ
æŠŠ HS256 æ”¹æˆ RS256ï¼Œç„¶åæ›´æ–°ç›¸å…³çš„å¯†é’¥åŠ è½½é€»è¾‘"
[Claude ç†è§£å¹¶æ‰§è¡Œ]
```

### ç»ˆç«¯åˆ«å

**åŸºç¡€åˆ«å**:
```bash
# ~/.bashrc æˆ– ~/.zshrc

# Claude Code
alias c='claude'
alias cdev='claude --system-prompt "$(cat ~/.claude/contexts/dev.md)"'
alias cpr='claude --system-prompt "$(cat ~/.claude/contexts/review.md)"'

# Git å¿«æ·æ–¹å¼
alias gs='git status'
alias gd='git diff'
alias gc='git commit'
alias gp='git push'

# é¡¹ç›®å¯¼èˆª
alias proj='cd ~/projects'
alias work='cd ~/workspace'

# å·¥å…·
alias gh='github'
alias co='code'
```

**ç»„åˆåˆ«å**:
```bash
# å¼€å¯å¼€å‘ä¼šè¯ï¼ˆå¸¦ tmuxï¼‰
alias dev='tmux new-session -d -s dev "npm run dev" && claude'

# å¿«é€Ÿ PR åˆ›å»º
alias pr='git push && gh pr create --fill'

# æµ‹è¯• + è¦†ç›–ç‡
alias tc='npm test -- --coverage'
```

---

## èµ„æºå’Œå‚è€ƒ

### ä»£ç†ç¼–æ’

**Claude Flow**:
- URL: https://github.com/ruvnet/claude-flow
- æè¿°: ä¼ä¸šçº§ç¼–æ’å¹³å°ï¼ŒåŒ…å« 54+ ä¸“ç”¨ä»£ç†
- é€‚ç”¨åœºæ™¯: å¤§å‹é¡¹ç›®ï¼Œå¤æ‚å·¥ä½œæµ

### è‡ªæˆ‘æ”¹è¿›è®°å¿†

**Continuous Learning Skill**:
- URL: https://github.com/affaan-m/everything-claude-code/tree/main/skills/continuous-learning
- æè¿°: æœ¬æŒ‡å—ä¸­ä»‹ç»çš„æŒç»­å­¦ä¹ ç³»ç»Ÿ

**Session Reflection Pattern**:
- URL: https://rlancemartin.github.io/2025/12/01/claude_diary/
- æè¿°: ä¼šè¯åæ€æ¨¡å¼ï¼Œè®°å½•å­¦ä¹ å’Œæ”¹è¿›

### ç³»ç»Ÿæç¤ºå‚è€ƒ

**System Prompts Collection**:
- URL: https://github.com/x1xhlol/system-prompts-and-models-of-ai-tools
- Stars: 110k+
- æè¿°: å„ç§ AI å·¥å…·çš„ç³»ç»Ÿæç¤ºé›†åˆ

### å®˜æ–¹èµ„æº

**Anthropic Academy**:
- URL: https://anthropic.skilljar.com
- æè¿°: å®˜æ–¹åŸ¹è®­å’Œè®¤è¯

**Claude API æ–‡æ¡£**:
- URL: https://platform.claude.com/docs
- æè¿°: API å‚è€ƒå’Œå®šä»·

### ç¤¾åŒºè´¡çŒ®

**æ ¸å¿ƒå‚è€ƒæ–‡çŒ®**:
- [Anthropic: Demystifying evals for AI agents](https://www.anthropic.com/engineering/demystifying-evals-for-ai-agents)
- [YK: 32 Claude Code Tips](https://agenticcoding.substack.com/p/32-claude-code-tips-from-basics-to)
- [RLanceMartin: Session Reflection Pattern](https://rlancemartin.github.io/2025/12/01/claude_diary/)

**ç¤¾åŒºè´¡çŒ®è€…**:
- @PerceptualPeak: å­ä»£ç†ä¸Šä¸‹æ–‡åå•†
- @menhguin: ä»£ç†æŠ½è±¡åˆ†çº§
- @omarsar0: å¤åˆ©æ•ˆåº”å“²å­¦

---

## é‡Œç¨‹ç¢‘

**Everything Claude Code é¡¹ç›®**:
- â­ 25,000+ GitHub stars
- ğŸ• < 1 å‘¨å†…è¾¾æˆ
- ğŸŒŸ ç¤¾åŒºé©±åŠ¨çš„å¢é•¿

---

## æ€»ç»“

### å…³é”®è¦ç‚¹

1. **MCP ä¸æ˜¯å…è´¹çš„** - è€ƒè™‘ CLI + Skills æ›¿ä»£æ–¹æ¡ˆ
2. **å†…å­˜æŒä¹…åŒ–æ˜¯æ ¸å¿ƒ** - ä½¿ç”¨ hooks è‡ªåŠ¨åŒ–è·¨ä¼šè¯è®°å¿†
3. **æŒç»­å­¦ä¹ é¿å…é‡å¤** - å°†å‘ç°è½¬åŒ–ä¸ºå¯å¤ç”¨ skills
4. **Token ä¼˜åŒ–é æ¶æ„** - æ­£ç¡®çš„æ¨¡å‹é€‰æ‹© + mgrep + æ¨¡å—åŒ–ä»£ç 
5. **éªŒè¯æ˜¯å¿…éœ€çš„** - pass@k vs pass^kï¼ŒçŸ¥é“ä½•æ—¶ä½¿ç”¨å“ªä¸ª
6. **å¹¶è¡ŒåŒ–éœ€è¦çºªå¾‹** - æœ€å°‘å¿…è¦å®ä¾‹ï¼Œæ˜ç¡®åˆ†å·¥
7. **æŠ•èµ„å¤åˆ©æ•ˆåº”** - æ—©æœŸæ„å»ºæ¨¡å¼ï¼Œé•¿æœŸæ”¶ç›Š

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³å¼€å§‹**:
1. âœ… å®‰è£… memory persistence hooks
2. âœ… åˆ›å»º 5 ä¸ªæœ€å¸¸ç”¨çš„ skills
3. âœ… è®¾ç½®åŠ¨æ€ç³»ç»Ÿæç¤ºåˆ«å
4. âœ… é…ç½® continuous learning

**ç¬¬ä¸€å‘¨ç›®æ ‡**:
- è®°å½•è‡³å°‘ 3 ä¸ªä¼šè¯
- æå–è‡³å°‘ 1 ä¸ª learned skill
- ä¼˜åŒ–è‡³å°‘ 1 ä¸ª MCP â†’ CLI + Skill

**ç¬¬ä¸€æœˆç›®æ ‡**:
- å»ºç«‹å®Œæ•´çš„ 5-phase orchestration
- ç§¯ç´¯ 10+ learned skills
- Token ä½¿ç”¨å‡å°‘ 30%+

### æœ€ç»ˆæ€è€ƒ

**æ¥è‡ªä½œè€…**:
> "è¿™äº›æ¨¡å¼æ˜¯æˆ‘ 10+ ä¸ªæœˆæ—¥å¸¸ä½¿ç”¨çš„ç»“æ™¶ã€‚ä¸æ˜¯æ‰€æœ‰æŠ€å·§éƒ½é€‚åˆæ‰€æœ‰äººï¼Œä½†æ ¸å¿ƒåŸåˆ™æ˜¯é€šç”¨çš„ï¼š
>
> 1. è‡ªåŠ¨åŒ–è®°å¿†ï¼ˆhooksï¼‰
> 2. æŒç»­å­¦ä¹ ï¼ˆskillsï¼‰
> 3. ä¼˜åŒ–æˆæœ¬ï¼ˆtoken engineeringï¼‰
> 4. éªŒè¯è´¨é‡ï¼ˆevalsï¼‰
> 5. æˆ˜ç•¥æ€§å¹¶è¡Œï¼ˆæœ€å°å¿…è¦å®ä¾‹ï¼‰
>
> ä»å°å¤„å¼€å§‹ï¼Œè¿­ä»£æ”¹è¿›ï¼Œäº«å—å¤åˆ©æ•ˆåº”ã€‚"

---

**å®Œæ•´èµ„æº**: https://github.com/affaan-m/everything-claude-code

**ç”Ÿæˆæ—¶é—´**: 2026-02-16 00:39:59
**è§£è¯»ä½œè€…**: Claude Sonnet 4.5 (AI Assistant)
**åŸºäºç‰ˆæœ¬**: everything-claude-code (latest)
